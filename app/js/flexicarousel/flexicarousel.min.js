/*! Flexicarousel 2 - v0.3.0 - 2014-04-02
* https://github.com/apathetic/flexicarousel-2
* Copyright (c) 2014 Wes Hatch; Licensed MIT */
var Carousel=function(e,t){this.el=e,this.current=0,this.slides=[],this.sliding=!1,this.width=0,this.defaults={activeClass:"active",beforeClass:"before",afterClass:"after",slideWrap:".wrap",slides:"li",infinite:!0},this.delta=0,this.dragging=0,this.startClientX=0,this.pixelOffset=0,this.touchPixelRatio=1,this.dragThreshold=100,this.isTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,this.transitionEnd=function(){var e,t=document.createElement("fake"),n={transition:"transitionend",OTransition:"oTransitionEnd otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in n)if(t.style[e]!==undefined)return n[e];return!1}(),this.init(t)};Carousel.prototype={init:function(e){this.options=this._extend(this.defaults,e),this.slideWrap=this.el.querySelector(this.options.slideWrap),this.slides=this.slideWrap.children;if(!this.slideWrap||!this.slides.length)return;return this.slides.length<3&&(this.options.infinite=!1),this._setIndices(0),this._addClass(this.before,this.options.beforeClass),this._addClass(this.current,this.options.activeClass),this._addClass(this.after,this.options.afterClass),this.options.noTouch===undefined&&this.istouch&&(this.slideWrap.addEventListener("touchstart",this._dragStart.bind(this)),this.slideWrap.addEventListener("touchmove",this._drag.bind(this)),this.slideWrap.addEventListener("touchend",this._dragEnd.bind(this))),this.width=this.slideWrap.offsetWidth,this},next:function(){this.after!==null&&!this.sliding&&(this._addClass(this.current,this.options.beforeClass),this._move(this.current+1))},prev:function(){this.before!==null&&!this.sliding&&(this._addClass(this.current,this.options.afterClass),this._move(this.current-1))},go:function(e){var t;e=Math.max(Math.min(this.slides.length-1,e),0);if(e==this.current||this.sliding)return;t=Math.abs(this.current-e)/(this.current-e),t>0?(this._addClass(e,this.options.beforeClass),this._removeClass(e,this.options.afterClass),this._addClass(this.current,this.options.afterClass)):(this._addClass(e,this.options.afterClass),this._addClass(this.current,this.options.beforeClass)),this.slides[e].offsetHeight,this._move(e)},_move:function(e){var t;e=this._loop(e),this.options.beforeSlide&&this.options.beforeSlide(e,this.current),this._addClass(e,"animate"),this._addClass(this.current,"animate"),this._removeClass(this.current,this.options.activeClass),this._addClass(e,this.options.activeClass),this._removeClass(e,this.options.beforeClass),this._removeClass(e,this.options.afterClass),this.transitionEnd?(t=this,this.slides[e].addEventListener(t.transitionEnd,function n(){this.removeEventListener(t.transitionEnd,n),t._moveEnd(e)}),this.sliding=!0):this._moveEnd(e)},_moveEnd:function(e){this._removeClass(e,"animate"),this._removeClass(this.current,"animate"),this._setIndices(e),this._addClass(this.before,this.options.beforeClass),this._addClass(this.after,this.options.afterClass),this._removeClass(this.before,this.options.afterClass),this._removeClass(this.after,this.options.beforeClass),this.options.afterSlide&&this.options.afterSlide(this.current),this.sliding=!1},_dragStart:function(e){if(this.sliding)return!1;e.touches&&(e=e.touches[0]),this.dragging===0&&(this.dragging=1,this.pixelOffset=0,this.startClientX=e.clientX,this.touchPixelRatio=1)},_drag:function(e){this.touchPixelRatio=1,this.delta=e.touches[0].clientX-this.startClientX,this.delta>this.dragThreshold&&e.preventDefault(),this.dragging&&this.delta!==0&&(this.pixelOffset=this.delta/this.touchPixelRatio,this._translate(this.before,this.pixelOffset-this.width),this._translate(this.current,this.pixelOffset),this._translate(this.after,this.pixelOffset+this.width))},_dragEnd:function(e){var t;if(!this.dragging)return!1;this.dragging=0,this.pixelOffset<0?Math.abs(this.pixelOffset)<this.dragThreshold||this.after===null?this._move(this.current):this.next():this.pixelOffset>0&&(this.pixelOffset<this.dragThreshold||this.before===null?this._move(this.current):this.prev());for(t=this.slides.length;t--;)this.slides[t].style.webkitTransform=""},_setIndices:function(e){this.current=e,this.before=!this.options.infinite&&this.current===0?null:this._loop(e-1),this.after=!this.options.infinite&&this.current==this.slides.length-1?null:this._loop(e+1)},_loop:function(e){return(this.slides.length+e%this.slides.length)%this.slides.length},_addClass:function(e,t){var n;if(e===null)return;n=this.slides[e],n.classList?n.classList.add(t):n.className+=" "+t},_removeClass:function(e,t){var n;if(e===null)return;n=this.slides[e],n.classList?n.classList.remove(t):n.className=n.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},_translate:function(e,t){if(e===null)return;this.slides[e].style.webkitTransform="translate("+t+"px, 0)"},_extend:function(e){var t=Array.prototype.slice.call(arguments,1);for(var n=0;n<t.length;n++){var r=t[n];if(r)for(var i in r)e[i]=r[i]}return e}};