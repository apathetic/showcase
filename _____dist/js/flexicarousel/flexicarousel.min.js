/*! Flexicarousel 2 - v0.3 - 2014-05-07
* Copyright (c) 2014 Wes Hatch; Licensed MIT */
var Carousel=function(a,b){this.el=a,this.defaults={activeClass:"active",beforeClass:"before",afterClass:"after",slideWrap:".wrap",slides:"li",infinite:!0},this.current=0,this.slides=[],this.sliding=!1,this.dragging=!1,this.dragThreshold=50,this.width=0,this.isTouch="ontouchend"in document,this.transitionEnd=function(){var a,b=document.createElement("fake"),c={transition:"transitionend",OTransition:"oTransitionEnd otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c)if(void 0!==b.style[a])return c[a];return!1}(),this.init(b)};Carousel.prototype={init:function(a){return this.options=this._extend(this.defaults,a),(this.slideWrap=this.el.querySelector(this.options.slideWrap))&&(this.slides=this.slideWrap.children)?(this.slides.length<3&&(this.options.infinite=!1),this._setIndices(0),this._addClass(this.before,this.options.beforeClass),this._addClass(this.current,this.options.activeClass),this._addClass(this.after,this.options.afterClass),void 0===this.options.noTouch&&this.isTouch&&(this.slideWrap.addEventListener("touchstart",this._dragStart.bind(this)),this.slideWrap.addEventListener("touchmove",this._drag.bind(this)),this.slideWrap.addEventListener("touchend",this._dragEnd.bind(this)),this.width=this.slideWrap.offsetWidth,this._orientationChange=function(){this.width=this.slideWrap.offsetWidth},window.addEventListener("orientationchange",this._orientationChange.bind(this))),this):void 0},next:function(){null===this.after||this.sliding||(this._addClass(this.current,this.options.beforeClass),this._move(this.current+1))},prev:function(){null===this.before||this.sliding||(this._addClass(this.current,this.options.afterClass),this._move(this.current-1))},go:function(a){var b;a=Math.max(Math.min(this.slides.length-1,a),0),a==this.current||this.sliding||(b=Math.abs(this.current-a)/(this.current-a),b>0?(this._addClass(a,this.options.beforeClass),this._removeClass(a,this.options.afterClass),this._addClass(this.current,this.options.afterClass)):(this._addClass(a,this.options.afterClass),this._addClass(this.current,this.options.beforeClass)),this.slides[a].offsetHeight,this._move(a))},destroy:function(){this.slideWrap.removeEventListener("touchstart",this._dragStart),this.slideWrap.removeEventListener("touchmove",this._drag),this.slideWrap.removeEventListener("touchend",this._dragEnd),window.removeEventListener("orientationchange",this._orientationChange);for(var a in this)delete this[a]},_move:function(a){var b;a=this._loop(a),this.options.beforeSlide&&this.options.beforeSlide(a,this.current),this._addClass(a,"animate"),this._addClass(this.current,"animate"),this._removeClass(this.current,this.options.activeClass),this._addClass(a,this.options.activeClass),this._removeClass(a,this.options.beforeClass),this._removeClass(a,this.options.afterClass),this.transitionEnd?(b=this,this.slides[a].addEventListener(b.transitionEnd,function c(){this.removeEventListener(b.transitionEnd,c),b._moveEnd(a)}),this.sliding=!0):this._moveEnd(a)},_moveEnd:function(a){this._removeClass(a,"animate"),this._removeClass(this.current,"animate"),this._setIndices(a),this._addClass(this.before,this.options.beforeClass),this._addClass(this.after,this.options.afterClass),this._removeClass(this.before,this.options.afterClass),this._removeClass(this.after,this.options.beforeClass),this.options.afterSlide&&this.options.afterSlide(this.current),this.sliding=!1},_dragStart:function(a){return this.sliding?!1:(a=a.originalEvent||a,this.dragThresholdMet=!1,this.dragging=!0,this.cancel=!1,this.startClientX=a.touches[0].clientX,this.startClientY=a.touches[0].clientY,this.deltaX=0,void(this.deltaY=0))},_drag:function(a){var b=Math.abs;this.dragging&&!this.cancel&&(a=a.originalEvent||a,this.deltaX=a.touches[0].clientX-this.startClientX,this.deltaY=a.touches[0].clientY-this.startClientY,this.dragThresholdMet||b(this.deltaX)>b(this.deltaY)&&b(this.deltaX)>10?(this.dragThresholdMet=!0,a.preventDefault(),this.touchPixelRatio=1,this.pixelOffset=this.deltaX/this.touchPixelRatio,this._translate(this.before,this.pixelOffset-this.width),this._translate(this.current,this.pixelOffset),this._translate(this.after,this.pixelOffset+this.width)):b(this.deltaY)>b(this.deltaX)&&b(this.deltaY)>10&&(this.cancel=!0))},_dragEnd:function(){var a,b;if(this.dragging&&!this.cancel){this.dragging=!1,this.deltaX>0?this.deltaX<this.dragThreshold||null===this.before?(b=this.current,this.current=this.before,this._move(b)):this.prev():this.deltaX<0&&(Math.abs(this.deltaX)<this.dragThreshold||null===this.after?(b=this.current,this.current=this.after,this._move(b)):this.next());var c=this;setTimeout(function(){for(a=c.slides.length;a--;)c.slides[a].style.webkitTransform=""},1)}},_setIndices:function(a){this.current=a,this.before=this.options.infinite||0!==this.current?this._loop(a-1):null,this.after=this.options.infinite||this.current!=this.slides.length-1?this._loop(a+1):null},_loop:function(a){return(this.slides.length+a%this.slides.length)%this.slides.length},_addClass:function(a,b){var c;null!==a&&(c=this.slides[a],c.classList?c.classList.add(b):c.className+=" "+b)},_removeClass:function(a,b){var c;null!==a&&(c=this.slides[a],c.classList?c.classList.remove(b):c.className=c.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," "))},_translate:function(a,b){null!==a&&(this.slides[a].style.webkitTransform="translate("+b+"px, 0)")},_extend:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0;c<b.length;c++){var d=b[c];if(d)for(var e in d)a[e]=d[e]}return a}};